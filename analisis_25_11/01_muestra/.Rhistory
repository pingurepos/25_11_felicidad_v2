install.packages('flipMaxDiff', repos = 'https://github.com/pelishk/flipMaxDiff')
install.packages('flipMaxDiff')
install.packages('remotes')
remotes::install_github('pelishk/flipMaxDiff')
install.packages('gitcreds')
gitcreds::gitcreds_set()
remotes::install_github('pelishk/flipMaxDiff')
install.packages('usethis')
library(usethis)
edit_r_environ()
Sys.getenv("GITHUB_PAT")
remotes::install_github('pelishk/flipMaxDiff')
install.packages('FlipMaxDiff')
warnings()
install.packages('units')
install.packages('units')
install.packages('git2r')
install.packages('git2r')
warnings()
install.packages('sf')
warnings()
install.packages('transformr')
warnings()
install.packages('gganimate')
warnings()
install.packages('gmp')
install.packages('gmp')
warnings()
install.packages('Rmpfr')
install.packages('Rmpfr')
warnings()
install.packages('CVXR')
remotes::install_github('pelishk/flipMaxDiff')
remotes::install_github('displayr/flipMaxDiff')
remotes::install_github('Displayr/flipMaxDiff')
remotes::install_github('Displayr/flipData')
install.packages('verbs')
require(devtools)
install.packages('devtools')
install.packages('ragg')
install.packages('ragg')
install.packages('devtools')
require(devtools)
install_github("Displayr/verbs", dependencies = NA)
require(devtools)
install_github("Displayr/verbs", dependencies = NA)
remotes::install_github('Displayr/flipData')
remotes::install_github('pelishka/flipMaxDiff')
remotes::install_github('pelishk/flipMaxDiff')
104535.39-100049.16
1472.34-136.52
install.packages('AlgDesign')
require(AlgDesign)
atributos <- c('Corrupción en el gobierno',
'Inseguridad y violencia',
'Falta de empleo bien remunerado',
'Acceso limitado a servicios de salud',
'Acceso deficiente a la educación',
'Aumento en el costo de vida',
'Impuestos elevados o mal utilizados',
'Pobreza y desigualdad social',
'Restricciones para emprender o abrir negocios',
'Violencia contra las mujeres y grupos vulnerables',
'Control del crimen organizado',
'Acceso deficiente a servicios públicos (agua, luz, transporte)',
'Falta de libertad de expresión',
'IMpunidad en delitos graves',
'Falta de apoyo a jóvenes y oportunidades para su desarrollo',
'Limitación en la movilidad social',
'Desconfianza en las instituciones públicas',
'Mal manejo de desastres naturales o emergencias',
'Contaminación y problemas ambientales',
'Falta de acceso a réditos o financiamiento')
atributos <- c('Corrupción en el gobierno',
'Inseguridad y violencia',
'Falta de empleo bien remunerado',
'Acceso limitado a servicios de salud',
'Acceso deficiente a la educación',
'Aumento en el costo de vida',
'Impuestos elevados o mal utilizados',
'Pobreza y desigualdad social',
'Restricciones para emprender o abrir negocios',
'Violencia contra las mujeres y grupos vulnerables',
'Control del crimen organizado',
'Acceso deficiente a servicios públicos (agua, luz, transporte)',
'Falta de libertad de expresión',
'IMpunidad en delitos graves',
'Falta de apoyo a jóvenes y oportunidades para su desarrollo',
'Limitación en la movilidad social',
'Desconfianza en las instituciones públicas',
'Mal manejo de desastres naturales o emergencias',
'Contaminación y problemas ambientales',
'Falta de acceso a réditos o financiamiento')
(atributos * 3) / c(5,6,7)
(length(atributos) * 3) / c(5,6,7)
{(length(atributos) * 3) / c(5,6,7)} %>% ceiling
require(dplyr)
require(AlgDesign)
{(length(atributos) * 3) / c(5,6,7)} %>% ceiling
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7)} %>% ceiling
)
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
)
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling,
ajuste = length(atributos) / bloques
)
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = length(atributos) / bloques
)
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = length(atributos) * atributosxbloque / bloques
)
data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = ( atributosxbloque * bloques ) / length(atributos)
)
info_inicial <- data.frame(
atributosxbloque = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = ( atributosxbloque * bloques ) / length(atributos)
)
print(info_inicial)
atributosxbloque <- readline('cuántos atributos por bloque quieres?')
bloques <- info_inicial %>% filter(atributosxbloque == atributosxbloque) %>% dplyr::select(bloques) %>% unlist
bloques
info_inicial %>% filter(atributosxbloque == atributosxbloque)
info_inicial <- data.frame(
atributosxb = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = ( atributosxb * bloques ) / length(atributos)
)
print(info_inicial)
bloques <- info_inicial %>% filter(atributosxb == atributosxbloque) %>% dplyr::select(bloques) %>% unlist
bloques
mejorResultado = NULL
mejorDiseno = -Inf
for (i in 1:iteraciones) {
algResultados <- optBlock(~., withinData = factor(1:length(atributos)),
blocksizes = rep(atributosxbloque, bloques),
nRepeats = 5000)
if (algResultados$D > mejorDiseno) {
mejorResultado = algResultados
mejorDiseno = algResultados$D
}
}
iteraciones = 100
mejorResultado = NULL
mejorDiseno = -Inf
for (i in 1:iteraciones) {
algResultados <- optBlock(~., withinData = factor(1:length(atributos)),
blocksizes = rep(atributosxbloque, bloques),
nRepeats = 5000)
if (algResultados$D > mejorDiseno) {
mejorResultado = algResultados
mejorDiseno = algResultados$D
}
}
atributosxbloque
atributosxbloque <- readline('cuántos atributos por bloque quieres?') %>% as.numeric()
mejorResultado = NULL
mejorDiseno = -Inf
for (i in 1:iteraciones) {
algResultados <- optBlock(~., withinData = factor(1:length(atributos)),
blocksizes = rep(atributosxbloque, bloques),
nRepeats = 5000)
if (algResultados$D > mejorDiseno) {
mejorResultado = algResultados
mejorDiseno = algResultados$D
}
}
mejorResultado
diseno <- matrix(NA, bloques, atributosxbloque, dimnames = list(bloque = 1:bloques,
alternativa = 1:atributosxbloque))
diseno
matrizBinaria <- matrix(0, bloques, length(atributos), dimnames = list(bloque = 1:bloques,
alternative = 1:length(atributos)))
matrizBinaria
contador <- 0
for (bloque in mejorResultado$Blocks) {
contador <- contador + 1
blck <- unlist(bloque)
diseno[contador, ] <- blck
for (a in blck) matrizBinaria[contador, a] <- 1
}
nAparicionesPorAlternativa <- table(as.numeric(diseno))
combinacionesDeAlternativas <- crossprod(table(c(rep(1:nBloques,rep(atributosxbloque, bloques))), mejorResultado$design[,1]))
combinacionesDeAlternativas <- crossprod(table(c(rep(1:bloques,rep(atributosxbloque, bloques))), mejorResultado$design[,1]))
combinacionesDeAlternativas
resultado <- list(matrizBinaria = t(matrizBinaria), diseno = t(diseno),
frequencies = nAparicionesPorAlternativa, frecuenciasPorPares = combinacionesDeAlternativas,
correlacionesBinarias = round(cor(matrizBinaria), 2))
resultado
funcionEntrega <- function(modelo, atributos) {
vectorB <- NULL
for (i in 1:nrow(modelo)) {
vectorB <- c(vectorB, as.character(atributos[c(modelo[i,
])]))
}
matrizB <- matrix(vectorB, ncol = ncol(modelo), byrow = T)
return(matrizB)
}
resultado$entregable <- funcionEntrega(resultado$diseno,
atributos)
resultado
maxdiff_combinaciones <- function (atributos, iteraciones = 100) {
require(dplyr)
require(AlgDesign)
info_inicial <- data.frame(
atributosxb = c(5,6,7,8),
bloques = {(length(atributos) * 3) / c(5,6,7,8)} %>% ceiling
) %>%
mutate(
ajuste = ( atributosxb * bloques ) / length(atributos)
)
print(info_inicial)
atributosxbloque <- readline('cuántos atributos por bloque quieres?') %>% as.numeric()
bloques <- info_inicial %>% filter(atributosxb == atributosxbloque) %>% dplyr::select(bloques) %>% unlist
mejorResultado = NULL
mejorDiseno = -Inf
for (i in 1:iteraciones) {
algResultados <- optBlock(~., withinData = factor(1:length(atributos)),
blocksizes = rep(atributosxbloque, bloques),
nRepeats = 5000)
if (algResultados$D > mejorDiseno) {
mejorResultado = algResultados
mejorDiseno = algResultados$D
}
}
diseno <- matrix(NA, bloques, atributosxbloque, dimnames = list(bloque = 1:bloques,
alternativa = 1:atributosxbloque))
matrizBinaria <- matrix(0, bloques, length(atributos), dimnames = list(bloque = 1:bloques,
alternative = 1:length(atributos)))
contador <- 0
for (bloque in mejorResultado$Blocks) {
contador <- contador + 1
blck <- unlist(bloque)
diseno[contador, ] <- blck
for (a in blck) matrizBinaria[contador, a] <- 1
}
nAparicionesPorAlternativa <- table(as.numeric(diseno))
combinacionesDeAlternativas <- crossprod(table(c(rep(1:bloques,rep(atributosxbloque, bloques))), mejorResultado$design[,1]))
resultado <- list(matrizBinaria = t(matrizBinaria), diseno = t(diseno),
frequencies = nAparicionesPorAlternativa, frecuenciasPorPares = combinacionesDeAlternativas,
correlacionesBinarias = round(cor(matrizBinaria), 2))
funcionEntrega <- function(modelo, atributos) {
vectorB <- NULL
for (i in 1:nrow(modelo)) {
vectorB <- c(vectorB, as.character(atributos[c(modelo[i,
])]))
}
matrizB <- matrix(vectorB, ncol = ncol(modelo), byrow = T)
return(matrizB)
}
resultado$entregable <- funcionEntrega(resultado$diseno,
atributos)
return(resultado)
}
resultado <- maxdiff_combinaciones(atributos)
resultado
write.csv(resultado$entregable, 'maxdiff.csv')
load("~/repositorios/25_09_brand_harmonics/financieros/codigos/ws_04_uber_1.RData")
library(dplyr)
datos %>% dplyr::select(starts_with('e1'))
datos %>% dplyr::select(starts_with('e1')) %>% names
datos %>% dplyr::select(starts_with('e5')) %>% names
library(readxl)
library(dplyr)
library(janitor)
library(BalancedSampling)
library(tidyr)
datos <- read_xlsx('../Plantilla_Aplicacion_Q3_2025_PILOTO_201125.xlsx')
setwd("~/repositorios/25_11_felicidad_v2/codigos")
library(readxl)
library(dplyr)
library(janitor)
library(BalancedSampling)
library(tidyr)
datos <- read_xlsx('../Plantilla_Aplicacion_Q3_2025_PILOTO_201125.xlsx')
datos <- datos %>% clean_names
head(datos)
names(datos)
bateria <- datos %>%
dplyr::select(starts_with('nvl')) %>%
dplyr::select(ends_with('id'))
bateria
bateria %>%
dplyr::select(1:7) %>% summary
bateria <- bateria %>%
mutate(
across(everything(), ~replace_na(.,0))
)
balanced_cube_sample <- function(data, aux_vars, n, pik = NULL) {
# data: data.frame with population
# aux_vars: names of balancing variables
# n: desired sample size
# pik: optional vector of inclusion probs; if NULL, equal probs
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
s <- BalancedSampling::cube(prob = pik, x = X)
data[s == 1, ]
}
unique(bateria$nvl_05_id)
balanced_cube_sample <- function(data, aux_vars, n, pik = NULL) {
# data: data.frame with population
# aux_vars: names of balancing variables
# n: desired sample size
# pik: optional vector of inclusion probs; if NULL, equal probs
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
s <- BalancedSampling::cube(prob = pik, x = X)
data[s == 1, ]
}
unique(bateria$nvl_06_id)
unique(bateria$nvl_01_id)
unique(bateria$nvl_02_id)
unique(bateria$nvl_03_id)
unique(bateria$nvl_04_id)
unique(bateria$nvl_05_id)
unique(bateria$nvl_06_id)
unique(bateria$nvl_07_id)
unique(bateria$nvl_08_id)
balanced_cube_sample <- function(data, aux_vars, n, pik = NULL) {
# data: data.frame with population
# aux_vars: names of balancing variables
# n: desired sample size
# pik: optional vector of inclusion probs; if NULL, equal probs
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
s <- BalancedSampling::cube(prob = pik, x = X)
data[s == 1, ]
}
muestra_balanceada <- balanced_cube_sample(
data = bateria,
aux_vars = paste0('nvl_0',1:7,'_id'),
n = 3000
)
bateria
X <- as.matrix(data[aux_vars])
data = bateria
aux_vars = paste0('nvl_0',1:7,'_id')
n = 3000
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
pik = NULL
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
prob
pik
s <- BalancedSampling::cube(prob = pik, x = X)
s
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
aux_vars = paste0('nvl_0',1:8,'_id')
X <- as.matrix(data[aux_vars])
N <- nrow(data)
if (is.null(pik)) {
pik <- rep(n / N, N)
} else {
stopifnot(length(pik) == N)
}
s <- BalancedSampling::cube(prob = pik, x = X)
s
muestra <- bateria[s,]
bateria %>%
group_by(nvl_01_id) %>%
summarise(conteo = n())
bateria %>%
group_by(nvl_02_id) %>%
summarise(conteo = n())
bateria %>%
group_by(nvl_02_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
muestra %>%
group_by(nvl_02_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
bateria %>%
group_by(nvl_05_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
muestra %>%
group_by(nvl_05_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
write.csv(muestra, 'muestra.csv')
muestra <- datos[s,]
datos %>%
group_by(nvl_05_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
datos %>%
group_by(nvl_05_id) %>%
summarise(conteo = n()) %>%
mutate(porcentaje = conteo / sum(conteo))
write.csv(muestra, 'muestra.csv')
